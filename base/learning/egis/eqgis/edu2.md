# 標高情報の可視化と地形の観察
数値標高モデル（DEM: Digital Elevation Model）を用いて、扇状地を可視化し、GIS上で地形の特徴を観察するため、地図を作成する。

- 標高データの取得と変換
- マージ（結合）と抽出：対象地域の作成
- 空間座標の変換
- 基本統計量の確認
- 標高情報を用いた色分け
- 等高線の出力
- 傾斜量図・陰影図
- 三次元表示
- 地形断面図の作成

### 作成した地図を用いた授業例
高等学校の地理総合の河川地形において、住吉川の扇状地を対象に標高情報を可視化しながら、地形の特徴を解説する授業を想定する。
![img](./img/edu2-1.png)

**以下も含めて、課題との関連などから、演習用データと解説用データは異なります。解説用データにはSRTMを使用しています。**

## 0. 基礎知識・スキル
- [GISの基本概念](https://gis-oer.github.io/gitbook/book/materials/00/00.html)
- [QGISの基本操作](https://gis-oer.github.io/gitbook/book/materials/QGIS/QGIS.html)
- [データのダウンロード](https://gis-oer.github.io/gitbook/book/materials/07/07.html)
- [空間座標の変換](https://gis-oer.github.io/gitbook/book/materials/08/08.html)

## 1. 数値標高モデルのダウンロード
数値標高モデルをダウンロードできるWebサイトは、いくつかあるが、今回は基盤地図情報から次の手順で入手する。基盤地図情報のダウンロードには、アカウントが必要なため事前に取得する。

1. [基盤地図情報サイト](https://www.gsi.go.jp/kiban/)にアクセスし、基盤地図情報のダウンロードに進む
2.  基本項目・数値標高モデルのダウンロードから、`数値標高モデル`をクリックする
3. アカウントがない場合は、アカウントを作成する
4. 左のウィンドウから`10mメッシュ 10B（地形図の等高線）`にのみチェックをつける（この後の作業で対象地域のデータがなかった場合は、他の項目を選択して使用する）
5. 左の地図ウィンドウから、地図をズームして対象地域を選択する（今回は、神戸市灘区と東灘区あたりの523501と523502の2地域をクリックする）
6. 下部のウィンドウに2つの範囲が選択されていることを確認し、右下の`ダウンロードリストに追加`をクリック
7. 下部ウィンドウのタブを`検索結果`から`ダウンロードリスト`に切り替えて、右下の`ダウンロード等へ`をクリック
8. ダウンロードファイルリストの右上にある`まとめてダウンロード`をクリックする
9. 利用目的アンケートを送信すると、データがダウンロードするためのメールが送信される
10. メールボックスでリンクを開き、データを入手する（ダウンロードしたデータはzipファイルのままにしておく）

### データの変換
QGISを立ち上げ、`プラグイン>プラグインの管理とインストール`から`QuickDEM4JP`を検索して、インストールする。
![img](./img/edu2-2.png)

インストールした`QuickDEM4JP`を用いて、ダウンロードしたデータを以下のように読み込む（2つのxmlファイルがあるが、以下の処理は一つずつ行う）。
![img](./img/edu2-3.png)

1. `プロセッシング > ツールボックス`を選択
2. ツールボックスから`QuickDEM4JP`を検索し、`XMLファイルからDEMを読み込む`をクリック
3. ダウンロードしたファイルを指定
4. 座標参照系を`JGD2011`にする
5. 出力ファイルを指定（ファイルは.tiffという形式（geotiff）で出力される）
6. `実行`をクリック

## 2. データの結合と座標変換
今回の場合、QGIS上に2つのgeotiffファイルがあるため、以下の処理で一つのファイルにつなげる。
![img](./img/edu2-4.png)

1. `ラスタ > Miscellaneous > 結合(gdal_merge)`を選択
2. 入力レイヤを2つ指定
3. 出力ファイルを指定
4. `実行`をクリック

データが結合されたことを確認し、不要なファイルを削除した後、次の手順で空間座標の変換の処理を行う。
![img](./img/edu2-5.png)

1. `ラスタ > Projections > 再投影(warp)`を選択
2. 入力レイヤを指定
3. 変換元CRSを`6668`
4. 変換先CRSを`6673`
5. `リサンプリング方法`を`バイリニア法（2×2カーネル）`
6. 出力ファイルを指定
7. `実行`をクリック

出力ファイルを確認後、以下のようにQGISのマップフレームの座標系を`6673`に合わせる。
![img](./img/edu2-6.png)

## 3. データの切り出し
住吉川の扇状地の範囲のデータを作成するため、結合したデータを以下の手順で切り出す。抽出範囲は、左下の図を参考に設定するが、狭すぎなければおおまかで良い。
![img](./img/edu2-7.png)

1. `ラスタ > Extraction > 範囲を指定して切り抜く`を選択
2. 入力レイヤを指定
3. `キャンパスに描画`を選択し、地図上で切り出したい範囲をドラッグして指定
4. 出力ファイルを指定
5. `実行`をクリック

## 4. 基本統計量などの確認
作成したレイヤの`プロパティ > 情報`をクリックすると、基本統計量、ピクセルの大きさ、座標参照系が確認できる。
![img](./img/edu2-8.png)

以下のように、ヒストグラムも確認できる。ヒストグラムは、標高ごとに色分けする際の参考にもなる。
![img](./img/edu2-9.png)

## 5. 標高値に基づく色分け（標高段彩図の作成）
次の手順で標高値に基づく色分けを行う。
![img](./img/edu2-10.png)

1. レイヤの`プロパティ > シンボロジ`を選択
2. `レンダリングタイプ`を`単バンド擬似カラー`
3. 最小値を0（通常、指定しない場合もあるが今回はわかりやすいように設定）
4. 最大値を750（通常、指定しない場合もあるが今回はわかりやすいように設定）
5. カラーランプを指定
6. モードを`等間隔分類`とする
7. 分類数を調整（今回は7とした）
8. `OK`をクリック

閾値は手動で変更することもできるため、様々な閾値の設定を試し、扇状地の地形が捉えやすいような分類に挑戦する。
![img](./img/edu2-11.png)

## 6. 等高線・傾斜量・陰影図の出力
扇状地の傾斜を説明しやすいように、標高値から以下の手順で10m間隔の等高線を出力する。
![img](./img/edu2-12.png)

1. `ラスタ > Extraction > 等高線（contour） `を選択
2. 入力レイヤを指定
3. `等高線の間隔`を`10`とする
4. 出力ファイルを指定
5. `実行`をクリック

詳細に傾斜を地図で表示することを目的に以下を行う。
![img](./img/edu2-13.png)

1. `ラスタ > Analysis > 傾斜（slope） `を選択
2. 入力レイヤを指定
3. 出力ファイルを指定
4. `実行`をクリック

二次元表示だと起伏がわかりにくい場合があるため、以下の手順で陰影図を作成し、地形の視認性を高める。
![img](./img/edu2-14.png)

1. `ラスタ > Analysis > 陰影図（hillshade） `を選択
2. 入力レイヤを指定
3. 出力ファイルを指定
4. `実行`をクリック

レイヤパネルで、DEM（標高値のラスタ）の下に陰影図を配置し、前者の`プロパティ`から` 透明度`を選択する。`グローバルな不透明度`を70%にすると、地形が視認しやすくなる。しかし、この方法は標高値に応じた色分けであるため、異なる地形でも同じ色で表現される場合もある点に注意する。
![img](./img/edu2-15.png)

## 7. 三次元表示
標高値をすれば3D表示もできる。ここでは、空中写真と標高データを重ね合わせて3D表示していくため、事前に以下のようにQGISに地理院タイルの空中写真を読み込んでおく。次に、`ビュー > 3Dマップビュー > 新規3Dマップビュー`を選択する。
![img](./img/edu2-16.png)

3D地図の画面が表示されたのを確認して、以下を行う。緑枠の`鉛直スケール`の値を2とすると土地の高さが２倍になる。起伏が小さい地域での地形の強調表示は有意義な場合もあるが、実際の地形と傾斜などの印象が変わるため、この値は注意して設定する。
![img](./img/edu2-17.png)

1. 設定を調整するアイコンをクリックし、`地形`を指定
2. `型`を`DEMラスタ`とする
3. もとになる標高データを指定
4. OKをクリック

設定が完了した後に、3D地図の画面を操作すると角度をつけて地形を俯瞰できるようになる。マウスがある場合はマウスホイールを、なければShiftキーを押しながら視点の角度を変えられる。
![img](./img/edu2-18.png)

## 8. 地形断面図の作成
`プラグイン>プラグインの管理とインストール`から`Profile tool`を検索して、インストールする。
![img](./img/edu2-19.png)

次の手順で断面図を作成する。
![img](./img/edu2-20.png)

1. `プラグイン> Profile tool > Terrain profile`を選択
2. 地図上で始点をクリックして、終点でダブルクリック
3. レイヤパネルで、標高値のラスタを選択
4. `Add Layer`をクリック

## 課題
次のいずれかの課題を実施し、次回の授業までにmanabaから提出してください。提出ファイルの形式は、パワポなどで作成し、**PDF**（スライドは2枚以内）で提出してください。地図がある場合は、**縮尺、凡例、方位記号、タイトル**をつけてください（3D表示地図を除く）。

### 課題①
本教材の冒頭で示した`作成した地図を用いた授業例`を想定し、扇状地を解説する授業を行う場合、以下の解説に利用できる地図を作成してください。パワポなどで作成した課題には、`GISで出力した地図を用いた解説方法（どのように扇状地を解説するのか）`も簡単に記載してください。

- 扇頂、扇央、扇端までの地形
- 扇頂から扇端までの傾斜（地図）
- 扇頂から扇端までの傾斜（断面・3D表示）

### 課題②
別の地域のDEMを用いて、扇状地を解説する授業案とそれに対応してGISで作成した複数の地図をまとめてください。











